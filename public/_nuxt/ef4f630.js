(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1068:function(t,e,n){"use strict";n.r(e);var o=n(510),r=n(219),l=n(124),c=n(776),d=n(566),h=n(218),m=n(530),v=n(552),_=n(520),f=n(509),y=(n(25),n(3));n(5),n(33),n(35),n(42),n(53),n(32),n(30),n(48),n(15),n(10),n(14),n(21),n(13),n(22);function x(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function k(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?x(Object(source),!0).forEach((function(e){Object(y.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):x(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var w={layout:"appDesktop",data:function(){return{loading:!1,viewHistory:!1,rescheduler:!1,statusItems:["Ticket Raised","Assigned","Work In Progress","Rescheduled","Validation","Closed"],expected_date:"",service_type:null,ticket_status:"",assigned_to:null,assigned_name:"",customer_id:null,customer_name:"",customer_detail:"",product_id:null,product_name:"",work_status:"",remarks:"",requirements:[],initial_inspection:"",form_id:null,type:"",zone:{},time_location:null,serviceForms:[{text:"1. Installation",value:"Installation"},{text:"2. Replacement/Repair",value:"Replacement"},{text:"3. Delivery",value:"Repair"}]}},components:{userAssign:function(){return n.e(21).then(n.bind(null,813))},productAssign:function(){return n.e(20).then(n.bind(null,1008))},history:function(){return n.e(113).then(n.bind(null,1094))},ZoneAssign:n(758).a},mounted:function(){this.$route.query.id?this.fetchService():this.ticket_status="Ticket Raised"},computed:{role:function(){var t,e,n,o,r;return null!==(t=this.$auth.user)&&void 0!==t&&null!==(e=t.role)&&void 0!==e&&e.includes("super")?"super":(null===(n=this.$auth.user)||void 0===n||null===(o=n.company)||void 0===o||null===(r=o.pivot)||void 0===r?void 0:r.role)||""}},methods:{closeTicket:function(){window.confirm('Warning! You are marking ticket as "closed"! Do you want to continue?')&&(this.ticket_status="closed",this.work_status="closed",this.updateService())},assignUser:function(t){var e;t&&(this.assigned_to=t.id,this.assigned_name="".concat(t.name," ").concat((null===(e=t.user_detail)||void 0===e?void 0:e.company_name)||""),"Ticket Raised"==this.ticket_status&&(this.ticket_status="Assigned"))},updateTicketStatus:function(){this.$route.query.id&&(this.ticket_status="Rescheduled")},assignCustomer:function(t){var e;t&&(this.customer_id=t.id,this.customer_name=t.name,this.customer_detail=t),null===(e=this.$refs.zoneAssign)||void 0===e||e.searchZones()},assignProduct:function(t){t&&(this.product_id=t.id,this.product_name=t.name)},fetchService:function(){var t=this;this.$axios.get("auth/services/"+this.$route.query.id).then((function(e){var n,o,r,l,c,d,h;t.name=e.data.name,t.status=e.data.status,t.expected_date=e.data.expected_date,t.type=e.data.type,t.service_type=e.data.service_type,t.customer_id=null===(n=e.data.customer)||void 0===n?void 0:n.id,t.customer_name=null===(o=e.data.customer)||void 0===o?void 0:o.name,t.customer_detail=e.data.customer,t.assigned_to=null===(r=e.data.assignee)||void 0===r?void 0:r.id,t.assigned_name=null===(l=e.data.assignee)||void 0===l?void 0:l.name,t.product_id=null===(c=e.data.product)||void 0===c?void 0:c.id,t.product_name=null===(d=e.data.product)||void 0===d?void 0:d.name,t.work_status=e.data.work_status,t.remarks=e.data.remarks,t.requirements=e.data.requirements||[],t.initial_inspection=e.data.initial_inspection,t.ticket_status=e.data.ticket_status,t.form_id=null===(h=e.data.form)||void 0===h?void 0:h.id,t.zone=e.data.zone?e.data.zone:{},t.time_location=e.data.time_location}))},updateService:function(){var t=this;if(this.customer_id)if(this.product_id)if(this.type){var e=this.$route.query.id||null;this.$axios.put("auth/services/"+e,{name:this.name,s_desc:this.s_desc,l_desc:this.l_desc,type:this.type,service_type:this.service_type,expected_date:this.expected_date,status:this.status,product_id:this.product_id,assigned_to:this.assigned_to,customer_id:this.customer_id,work_status:this.work_status,remarks:this.remarks,requirements:this.requirements,initial_inspection:this.initial_inspection,ticket_status:this.ticket_status,zone:this.zone}).then((function(e){t.$toast.success("Service Saved",{icon:"mdi-check-circle"}),t.$route.query.id||t.$router.replace({query:k(k({},t.$route.query),{},{id:e.data.id})}),t.rescheduler=!1}),(function(t){}))}else this.$toast.error("Please Assign Service Type");else this.$toast.error("Please Assign Product");else this.$toast.error("Please Assign Customer")}}},S=(n(894),n(26)),component=Object(S.a)(w,(function(){var t=this,e=this,n=e._self._c;return n(m.a,{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[n(r.a,{attrs:{"max-width":"700",width:"100%"}},[n(l.c,[n("div",{staticClass:"d-flex flex-row my-2"},[n(o.a,{attrs:{small:"",color:"primary",to:"/app/services",outlined:""}},[n(h.a,[e._v("mdi-arrow-left")])],1),e._v(" "),n(_.a),e._v(" "),n("h2",{staticClass:"black--text"},[e._v("Service Editor")])],1),e._v(" "),n("div",{staticClass:"statusBar px-1 my-2",staticStyle:{"max-width":"100%","overflow-x":"scroll"}},[n("div",{staticClass:"ma-2 row align-center",staticStyle:{width:"680px","overflow-x":"scroll"}},e._l(e.statusItems,(function(t,o){return n(r.a,{key:o,staticClass:"col font-weight-bold text-center",class:e.statusItems&&e.statusItems.indexOf(e.work_status)>=o?"primary white--text":"info",attrs:{flat:"",tile:""}},[n("div",[e._v(e._s(t))])])})),1)]),e._v(" "),n("userAssign",{attrs:{id:e.assigned_to,name:e.assigned_name,permissions:"Employee"},on:{assignTo:function(t){return e.assignUser(t)}}}),e._v(" "),n("userAssign",{attrs:{title:"Customer",id:e.customer_id,name:e.customer_name,customer_detail:e.customer_detail,permissions:"Customer"},on:{assignTo:function(t){return e.assignCustomer(t)}}}),e._v(" "),e.customer_id?n("zoneAssign",{ref:"zoneAssign",attrs:{id:e.customer_id,title:"Zone"},model:{value:e.zone,callback:function(t){e.zone=t},expression:"zone"}}):e._e(),e._v(" "),n("productAssign",{attrs:{id:e.product_id,name:e.product_name,title:"Product"},on:{assignTo:function(e){t.product_id=e.id,t.product_name=e.name}}}),e._v("\n      Expected Date: "+e._s(e.expected_date?e.$luxon(e.expected_date):"Not Set")+"\n      "),n(f.a,{attrs:{outlined:"",label:"Initial Remarks"},model:{value:e.initial_inspection,callback:function(t){e.initial_inspection=t},expression:"initial_inspection"}}),e._v(" "),n(c.a,{attrs:{outlined:"",items:["New Installation","Old Installation","Replacement","Repair","Delivery"],label:"Service Type"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),e._v(" "),n(v.a,{attrs:{outlined:"",items:e.serviceForms,label:"Service Form","prepend-inner-icon":"mdi-form-select"},model:{value:e.service_type,callback:function(t){e.service_type=t},expression:"service_type"}}),e._v(" "),n(f.a,{attrs:{filled:"",readonly:"",disabled:"Subadmin"==e.role,items:e.statusItems,label:"Ticket Status"},model:{value:e.ticket_status,callback:function(t){e.ticket_status=t},expression:"ticket_status"}}),e._v(" "),n(v.a,{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{outlined:"",disabled:"Subadmin"==e.role,items:e.statusItems,label:"Work Status"},model:{value:e.work_status,callback:function(t){e.work_status=t},expression:"work_status"}}),e._v(" "),n("div",[n(o.a,{directives:[{name:"show",rawName:"v-show",value:"Validation"==e.ticket_status||e.time_location&&e.time_location.end,expression:"ticket_status=='Validation'||(time_location&&time_location.end)"}],attrs:{color:"indigo",dark:""},on:{click:function(t){return e.closeTicket()}}},[e._v("Close Ticket")]),e._v(" "),n(h.a,{attrs:{small:""}},[e._v("mdi-information-outline")]),e._v(" Marks Ticket as Closed\n        "),n("p"),e._v(" "),n(o.a,{attrs:{color:"indigo",dark:""},on:{click:function(t){e.rescheduler=!0}}},[e._v("Reschedule Ticket")])],1)],1),e._v(" "),n(l.a,[e.form_id?n(o.a,{attrs:{outlined:"",to:"/app/services/forms?id=".concat(e.$route.query.id),color:"primary"}},[e._v("View Form")]):e._e(),e._v(" "),e.$route.query.id?n(o.a,{attrs:{outlined:"",color:"primary"},on:{click:function(t){e.viewHistory=!0}}},[e._v("View Activity")]):e._e(),e._v(" "),n(_.a),e._v(" "),n(o.a,{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:e.loading,type:"submit"},on:{click:function(t){return e.updateService()}}},[e._v("Save Service")])],1),e._v(" "),e.$route.query.id&&e.viewHistory?n("history",{attrs:{service_id:e.$route.query.id},model:{value:e.viewHistory,callback:function(t){e.viewHistory=t},expression:"viewHistory"}}):e._e()],1),e._v(" "),n(d.a,{attrs:{"max-width":"400"},model:{value:e.rescheduler,callback:function(t){e.rescheduler=t},expression:"rescheduler"}},[n(r.a,[n(l.d,[e._v("Reschedule Service")]),e._v(" "),n(l.c,[e._v("\n      Expected Date: "+e._s(e.expected_date?e.$luxon(e.expected_date):"Not Set")+"\n      "),n(f.a,{attrs:{filled:"",type:"date",label:e.product_id?"Reschedule":"Set Date"},on:{change:function(t){return e.updateTicketStatus()}},model:{value:e.expected_date,callback:function(t){e.expected_date=t},expression:"expected_date"}})],1),e._v(" "),n(l.a,[n(o.a,{staticClass:"spl-btn",attrs:{color:"primary",large:"",loading:e.loading,type:"submit"},on:{click:function(t){return e.updateService()}}},[e._v("Save")]),e._v(" "),n(o.a,{attrs:{outlined:"",color:"primary"},on:{click:function(t){e.rescheduler=!1}}},[e._v("Cancel")])],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports},758:function(t,e,n){"use strict";var o=n(568),r={props:{id:{default:null},value:{default:{}}},data:function(){return{createDialog:!1,assignee:{},zone_search:"",zones:[],loadingZones:!1,show1:!1}},watch:{zone_search:function(){this.searchZones()}},methods:{searchZones:function(){var t,e=this;(null===(t=this.zone_search)||void 0===t?void 0:t.length)<=2||(this.loadingZones=!0,this.$axios.get("/auth/users/".concat(this.id,"/zones"),{params:{name:this.zone_search,is:this.permissions}}).then((function(t){t.data&&t.data.length&&(e.zones=t.data),e.loadingZones=!1}),(function(t){e.loadingZones=!1})))}}},l=n(26),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",[e("p",[t._v("Zone Search: "),e("b",[t._v(t._s(t.value.zone))]),t._v(" "+t._s(t.value.address)+" ")]),t._v(" "),e("div",{staticClass:"d-flex flex-row"},[e(o.a,{attrs:{dense:"",outlined:"",clearable:"",loading:t.loadingZones,"search-input":t.zone_search,label:"Search Zone","item-text":"zone","return-object":"","prepend-inner-icon":"mdi-magnify",items:t.zones},on:{focus:function(e){return t.searchZones()},input:function(e){e?t.$emit("input",e):t.$emit("input",{})},"update:searchInput":function(e){t.zone_search=e},"update:search-input":function(e){t.zone_search=e}}})],1)])}),[],!1,null,null,null);e.a=component.exports},776:function(t,e,n){"use strict";n(15),n(10),n(14),n(21),n(13),n(22);var o=n(12),r=n(3),l=(n(5),n(86),n(182),n(236),n(44),n(25),n(42),n(53),n(528),n(343),n(549),n(552)),c=n(568),d=n(2);function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function m(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}e.a=c.a.extend({name:"v-combobox",props:{delimiters:{type:Array,default:function(){return[]}},returnObject:{type:Boolean,default:!0}},data:function(){return{editingIndex:-1}},computed:{computedCounterValue:function(){return this.multiple?this.selectedItems.length:(this.internalSearch||"").toString().length},hasSlot:function(){return l.a.options.computed.hasSlot.call(this)||this.multiple},isAnyValueAllowed:function(){return!0},menuCanShow:function(){return!!this.isFocused&&(this.hasDisplayedItems||!!this.$slots["no-data"]&&!this.hideNoData)},searchIsDirty:function(){return null!=this.internalSearch}},methods:{onInternalSearchChanged:function(t){if(t&&this.multiple&&this.delimiters.length){var e=this.delimiters.find((function(e){return t.endsWith(e)}));null!=e&&(this.internalSearch=t.slice(0,t.length-e.length),this.updateTags())}this.updateMenuDimensions()},genInput:function(){var input=c.a.options.methods.genInput.call(this);return delete input.data.attrs.name,input.data.on.paste=this.onPaste,input},genChipSelection:function(t,e){var n=this,o=l.a.options.methods.genChipSelection.call(this,t,e);return this.multiple&&(o.componentOptions.listeners=m(m({},o.componentOptions.listeners),{},{dblclick:function(){n.editingIndex=e,n.internalSearch=n.getText(t),n.selectedIndex=-1}})),o},onChipInput:function(t){l.a.options.methods.onChipInput.call(this,t),this.editingIndex=-1},onEnterDown:function(t){t.preventDefault(),this.getMenuIndex()>-1||this.$nextTick(this.updateSelf)},onKeyDown:function(t){var e=t.keyCode;!t.ctrlKey&&[d.w.home,d.w.end].includes(e)||l.a.options.methods.onKeyDown.call(this,t),this.multiple&&e===d.w.left&&0===this.$refs.input.selectionStart?this.updateSelf():e===d.w.enter&&this.onEnterDown(t),this.changeSelectedIndex(e)},onTabDown:function(t){if(this.multiple&&this.internalSearch&&-1===this.getMenuIndex())return t.preventDefault(),t.stopPropagation(),this.updateTags();c.a.options.methods.onTabDown.call(this,t)},selectItem:function(t){this.editingIndex>-1?this.updateEditing():(c.a.options.methods.selectItem.call(this,t),this.internalSearch&&this.multiple&&this.getText(t).toLocaleLowerCase().includes(this.internalSearch.toLocaleLowerCase())&&(this.internalSearch=null))},setSelectedItems:function(){null==this.internalValue||""===this.internalValue?this.selectedItems=[]:this.selectedItems=this.multiple?this.internalValue:[this.internalValue]},setValue:function(t){l.a.options.methods.setValue.call(this,void 0===t?this.internalSearch:t)},updateEditing:function(){var t=this,e=this.internalValue.slice(),n=this.selectedItems.findIndex((function(e){return t.getText(e)===t.internalSearch}));if(n>-1){var r="object"===Object(o.a)(e[n])?Object.assign({},e[n]):e[n];e.splice(n,1),e.push(r)}else e[this.editingIndex]=this.internalSearch;this.setValue(e),this.editingIndex=-1,this.internalSearch=null},updateCombobox:function(){this.searchIsDirty&&(this.internalSearch!==this.getText(this.internalValue)&&this.setValue(),(Boolean(this.$scopedSlots.selection)||this.hasChips)&&(this.internalSearch=null))},updateSelf:function(){this.multiple?this.updateTags():this.updateCombobox()},updateTags:function(){var t=this,e=this.getMenuIndex();if(!(e<0&&!this.searchIsDirty||!this.internalSearch)){if(this.editingIndex>-1)return this.updateEditing();var n=this.selectedItems.findIndex((function(e){return t.internalSearch===t.getText(e)})),r=n>-1&&"object"===Object(o.a)(this.selectedItems[n])?Object.assign({},this.selectedItems[n]):this.internalSearch;if(n>-1){var l=this.internalValue.slice();l.splice(n,1),this.setValue(l)}if(e>-1)return this.internalSearch=null;this.selectItem(r),this.internalSearch=null}},onPaste:function(t){var e;if(this.$emit("paste",t),this.multiple&&!this.searchIsDirty){var n=null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text/vnd.vuetify.autocomplete.item+plain");n&&-1===this.findExistingIndex(n)&&(t.preventDefault(),l.a.options.methods.selectItem.call(this,n))}},clearableCallback:function(){this.editingIndex=-1,c.a.options.methods.clearableCallback.call(this)}}})},786:function(t,e,n){var content=n(895);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(9).default)("7b238a80",content,!0,{sourceMap:!1})},894:function(t,e,n){"use strict";n(786)},895:function(t,e,n){var o=n(8)((function(i){return i[1]}));o.push([t.i,".statusBar{border:1px solid var(--v-primary-base)}",""]),o.locals={},t.exports=o}}]);