(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1069:function(t,e,r){"use strict";r.r(e);var o=r(510),c=r(221),n=r(124),l=r(594),v=r(524),d=r(220),_=r(530),m=r(555),h=r(520),f=r(575),y=(r(25),r(32),r(15),r(10),r(14),r(21),r(13),r(22),r(3));r(5),r(33),r(35);function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var w={layout:"appDesktop",data:function(){return{loading:!1,service:{},serviceFormData:[],signatureToggle:!1,geoLocating:!1}},components:{serviceForm:function(){return r.e(16).then(r.bind(null,1094))},signature:function(){return Promise.all([r.e(14),r.e(15),r.e(22)]).then(r.bind(null,1095))}},mounted:function(){this.$route.query.id&&this.fetchService()},methods:{changeValue:function(t){var e=this.serviceFormData;e[t[1]]=t[0],this.serviceFormData=e},fetchService:function(){var t=this;this.$axios.get("auth/services/"+this.$route.query.id).then((function(e){var r;t.service=e.data,t.serviceFormData=(null===(r=e.data)||void 0===r||null===(r=r.form)||void 0===r?void 0:r.data)||[]}))},updateService:function(){var t=this;this.loading=!0;var e=this.$route.query.id||null,r=this.service;r.form=this.serviceFormData,this.$axios.put("auth/tasks/"+e,r).then((function(e){t.$toast.success("Service Saved",{icon:"mdi-check-circle"}),t.$route.query.id||t.$router.push("/app/services")}),(function(e){t.$toast.error("Something Went Wrong",{icon:"mdi-alert"})})).finally((function(){t.loading=!1}))},addRecord:function(t){var e=this;this.geoLocating=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){var r=t.coords;e.$toast.success("Time and Location Fetched");var o={accuracy:r.accuracy,latitude:r.latitude,longitude:r.longitude},time=(new Date).toISOString(),c=e.service.time_location||{};c.start&&c.start.time?(c.end={time:time,coordinates:o},e.$toast.show("Activity Finished"),e.service.ticket_status="Validation"):(c.start={time:time,coordinates:o},e.$toast.show("Activity Started")),e.service.time_location=function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(y.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},c),e.geoLocating=!1,e.updateService()}),(function(t){e.$toast.error(t.message),e.geoLocating=!1})):this.geoLocating=!1},geoCode:function(t,e){this.longitude=t,this.latitude=e}}},S=w,O=r(26),component=Object(O.a)(S,(function(){var t,e=this,r=e._self._c;return r(_.a,{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[r(c.a,{attrs:{width:"100%"}},[r(n.c,[r("div",{staticClass:"d-flex flex-row my-2"},[r(o.a,{attrs:{small:"",color:"primary",outlined:""},on:{click:function(t){return e.$router.back()}}},[r(d.a,[e._v("mdi-arrow-left")])],1),r(h.a),e._v(" "),r("h2",{staticClass:"black--text"},[e._v(e._s(e.service.name||"Task Activity"))])],1),e._v(" "),r(v.a,[e.service?r("div",{staticClass:"my-6"},[e.service.customer?r("div",[r("p",{staticClass:"font-weight-bold mb-1"},[e._v("Customer: "+e._s(e.service.customer.name)+" â€¢ "+e._s((null===(t=e.service.customer)||void 0===t||null===(t=t.user_detail)||void 0===t?void 0:t.company_name)||""))]),e._v(" "),e.service.customer.user_detail?r("div",[e._v("\n            "+e._s(e.service.customer.user_detail.address_1)+" "+e._s(e.service.customer.user_detail.address_2)),r("br"),e._v("\n            "+e._s(e.service.customer.user_detail.city)+" "+e._s(e.service.customer.user_detail.state)+" "+e._s(e.service.customer.user_detail.country)+" "),r("br"),e._v(e._s(e.service.customer.phone)+"\n          ")]):e._e()]):e._e(),e._v(" "),e.service.zone?r("p",{staticClass:"font-weight-bold mb-1"},[e._v("Zone: "+e._s(e.service.zone.zone))]):e._e(),e._v(" "),e.service.zone?r("p",[e._v(e._s(e.service.zone.address))]):e._e(),e._v(" "),e.service.time_location&&e.service.time_location.start?e._e():r(o.a,{attrs:{color:"primary",loading:e.geoLocating},on:{click:function(t){return e.addRecord()}}},[r(d.a,{attrs:{left:""}},[e._v("mdi-clock-fast")]),e._v(" Start Activity")],1),e._v(" "),r(f.a,{staticClass:"my-2",attrs:{outlined:"",label:"Activity Remarks",rows:"2"},model:{value:e.service.remarks,callback:function(t){e.$set(e.service,"remarks",t)},expression:"service.remarks"}}),e._v(" "),r(m.a,[r("thead",[r("tr",[r("th",[e._v("Activity")]),e._v(" "),r("th",[e._v("Date/Time")]),e._v(" "),r("th",[e._v("Location")])])]),e._v(" "),e.service.time_location?r("tbody",[e.service.time_location.start?r("tr",[r("td",[e._v("Start")]),e._v(" "),r("td",[e._v(e._s(e.service.time_location.start.time&&e.$luxon(e.service.time_location.start.time,"meds")))]),e._v(" "),e.service.time_location.start.coordinates?r("td",[r("a",{attrs:{target:"_blank",href:"https://maps.google.com/?q=".concat(e.service.time_location.start.coordinates.latitude,",").concat(e.service.time_location.start.coordinates.longitude)}},[e._v(e._s("Latitude: "+e.service.time_location.start.coordinates.latitude)+" "),r("br"),e._v(" "+e._s("Longitude: "+e.service.time_location.start.coordinates.longitude))])]):e._e()]):e._e(),e._v(" "),e.service.time_location.end?r("tr",[r("td",[e._v("Finish")]),e._v(" "),r("td",[e._v(e._s(e.service.time_location.end.time&&e.$luxon(e.service.time_location.end.time,"meds")))]),e._v(" "),r("td",[r("a",{attrs:{target:"_blank",href:"https://maps.google.com/?q=".concat(e.service.time_location.end.coordinates.latitude,",").concat(e.service.time_location.end.coordinates.longitude)}},[e._v(e._s(e.service.time_location.end.coordinates&&"Latitude:"+e.service.time_location.end.coordinates.latitude)+" "),r("br"),e._v(" "+e._s("Longitude: "+e.service.time_location.end.coordinates.longitude)+"\n              ")])])]):e._e()]):r("div",{staticClass:"amber--text text--darken-3 font-weight-bold"},[e._v("No Time/Location Added")])])],1):e._e(),e._v(" "),r(c.a,{staticClass:"container",attrs:{outlined:""}},[r(l.a,{staticStyle:{top:"-25px"},attrs:{color:"primary",label:""}},[e._v("Form")]),e._v(" "),r("serviceForm",{attrs:{formData:e.serviceFormData},on:{changeValue:function(t){return e.changeValue(t)}}})],1),e._v(" "),e.service.signature?r("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"".concat(e.$config.media_url,"/").concat(e.service.signature)}}):e._e(),e._v(" "),r("br"),e._v(" "),r(o.a,{attrs:{outlined:"",color:"primary"},on:{click:function(t){e.signatureToggle=!0}}},[r(d.a,{attrs:{left:""}},[e._v("mdi-signature-freehand")]),e._v("Add Signature")],1),e._v(" "),e.service.time_location&&e.service.time_location.start&&!e.service.time_location.end?r(o.a,{attrs:{loading:e.geoLocating,color:"accent"},on:{click:function(t){return e.addRecord()}}},[r(d.a,{attrs:{left:""}},[e._v("mdi-check-bold")]),e._v(" Finish Activity")],1):e._e()],1)],1),e._v(" "),r(n.a,[r(o.a,{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:e.loading,type:"submit",block:""},on:{click:function(t){return e.updateService()}}},[e._v("\n        Save Service")])],1)],1),e._v(" "),e.signatureToggle?r("signature",{on:{saveSignature:function(t){e.service.signature=t,e.updateService()}},model:{value:e.signatureToggle,callback:function(t){e.signatureToggle=t},expression:"signatureToggle"}}):e._e()],1)}),[],!1,null,null,null);e.default=component.exports}}]);