(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1069:function(e,t,n){"use strict";n.r(t);var o=n(510),r=n(219),c=n(124),l=n(776),d=n(566),_=n(218),m=n(530),v=n(552),h=n(520),f=n(509),y=(n(25),n(3));n(5),n(33),n(35),n(42),n(53),n(32),n(30),n(48),n(15),n(10),n(14),n(21),n(13),n(22);function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function w(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(y.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var x={layout:"appDesktop",data:function(){return{loading:!1,viewHistory:!1,rescheduler:!1,statusItems:["Ticket Raised","Assigned","Work In Progress","Rescheduled","Validation","Closed"],expected_date:"",service_type:null,ticket_status:"",assigned_to:null,assigned_name:"",customer_id:null,customer_name:"",customer_detail:"",product_id:null,product_name:"",work_status:"",remarks:"",requirements:[],initial_inspection:"",form_id:null,type:"",zone:{},time_location:null,serviceForms:[{text:"1. Installation",value:"Installation"},{text:"2. Replacement/Repair",value:"Replacement"},{text:"3. Delivery",value:"Repair"}]}},components:{userAssign:function(){return n.e(21).then(n.bind(null,813))},productAssign:function(){return n.e(20).then(n.bind(null,1008))},history:function(){return n.e(114).then(n.bind(null,1095))},ZoneAssign:n(759).a},mounted:function(){this.$route.query.id?this.fetchService():this.ticket_status="Ticket Raised"},computed:{role:function(){var e,t,n,o,r;return null!==(e=this.$auth.user)&&void 0!==e&&null!==(t=e.role)&&void 0!==t&&t.includes("super")?"super":(null===(n=this.$auth.user)||void 0===n||null===(o=n.company)||void 0===o||null===(r=o.pivot)||void 0===r?void 0:r.role)||""},id:function(){return this.$route.query.id}},watch:{id:function(){this.fetchService()}},methods:{closeTicket:function(){window.confirm('Warning! You are marking ticket as "closed"! Do you want to continue?')&&(this.ticket_status="closed",this.work_status="closed",this.updateService())},assignUser:function(e){var t;e&&(this.assigned_to=e.id,this.assigned_name="".concat(e.name," ").concat((null===(t=e.user_detail)||void 0===t?void 0:t.company_name)||""),"Ticket Raised"==this.ticket_status&&(this.ticket_status="Assigned"))},updateTicketStatus:function(){this.$route.query.id&&(this.ticket_status="Rescheduled")},assignCustomer:function(e){var t;e&&(this.customer_id=e.id,this.customer_name=e.name,this.customer_detail=e),null===(t=this.$refs.zoneAssign)||void 0===t||t.searchZones()},assignProduct:function(e){e&&(this.product_id=e.id,this.product_name=e.name)},fetchService:function(){var e=this;this.loading=!0,this.$axios.get("auth/services/"+this.$route.query.id).then((function(t){var n,o,r,c,l,d,_;e.name=t.data.name,e.status=t.data.status,e.expected_date=t.data.expected_date,e.type=t.data.type,e.service_type=t.data.service_type,e.customer_id=null===(n=t.data.customer)||void 0===n?void 0:n.id,e.customer_name=null===(o=t.data.customer)||void 0===o?void 0:o.name,e.customer_detail=t.data.customer,e.assigned_to=null===(r=t.data.assignee)||void 0===r?void 0:r.id,e.assigned_name=null===(c=t.data.assignee)||void 0===c?void 0:c.name,e.product_id=null===(l=t.data.product)||void 0===l?void 0:l.id,e.product_name=null===(d=t.data.product)||void 0===d?void 0:d.name,e.work_status=t.data.work_status,e.remarks=t.data.remarks,e.requirements=t.data.requirements||[],e.initial_inspection=t.data.initial_inspection,e.ticket_status=t.data.ticket_status,e.form_id=null===(_=t.data.form)||void 0===_?void 0:_.id,e.zone=t.data.zone?t.data.zone:{},e.time_location=t.data.time_location,e.loading=!1}),(function(t){e.$toast.error("An Error Occured, Please Refresh!")}))},updateService:function(){var e=this;if(this.customer_id)if(this.product_id)if(this.type){var t=this.$route.query.id||null;this.$axios.put("auth/services/"+t,{name:this.name,s_desc:this.s_desc,l_desc:this.l_desc,type:this.type,service_type:this.service_type,expected_date:this.expected_date,status:this.status,product_id:this.product_id,assigned_to:this.assigned_to,customer_id:this.customer_id,work_status:this.work_status,remarks:this.remarks,requirements:this.requirements,initial_inspection:this.initial_inspection,ticket_status:this.ticket_status,zone:this.zone}).then((function(t){e.$toast.success("Service Saved",{icon:"mdi-check-circle"}),e.$route.query.id||e.$router.replace({query:w(w({},e.$route.query),{},{id:t.data.id})}),e.rescheduler=!1}),(function(e){}))}else this.$toast.error("Please Assign Service Type");else this.$toast.error("Please Assign Product");else this.$toast.error("Please Assign Customer")}}},S=(n(894),n(26)),component=Object(S.a)(x,(function(){var e=this,t=this,n=t._self._c;return n(m.a,{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[n(r.a,{attrs:{"max-width":"700",width:"100%"}},[n(c.c,[n("div",{staticClass:"d-flex flex-row my-2"},[n(o.a,{attrs:{small:"",color:"primary",to:"/app/services",outlined:""}},[n(_.a,[t._v("mdi-arrow-left")])],1),t._v(" "),n(h.a),t._v(" "),n("h2",{staticClass:"black--text"},[t._v("Service Editor "),t.loading?n(_.a,[t._v("mdi-hexagon mdi-spin")]):t._e()],1)],1),t._v(" "),n("div",{staticClass:"statusBar px-1 my-2",staticStyle:{"max-width":"100%","overflow-x":"scroll"}},[n("div",{staticClass:"ma-2 row align-center",staticStyle:{width:"680px","overflow-x":"scroll"}},t._l(t.statusItems,(function(e,o){return n(r.a,{key:o,staticClass:"col font-weight-bold text-center",class:t.statusItems&&t.statusItems.indexOf(t.work_status)>=o?"primary white--text":"info",attrs:{flat:"",tile:""}},[n("div",[t._v(t._s(e))])])})),1)]),t._v(" "),n("userAssign",{attrs:{id:t.assigned_to,name:t.assigned_name,permissions:"Employee"},on:{assignTo:function(e){return t.assignUser(e)}}}),t._v(" "),n("userAssign",{attrs:{title:"Customer",id:t.customer_id,name:t.customer_name,customer_detail:t.customer_detail,permissions:"Customer"},on:{assignTo:function(e){return t.assignCustomer(e)}}}),t._v(" "),t.customer_id?n("zoneAssign",{ref:"zoneAssign",attrs:{id:t.customer_id,title:"Zone"},model:{value:t.zone,callback:function(e){t.zone=e},expression:"zone"}}):t._e(),t._v(" "),n("productAssign",{attrs:{id:t.product_id,name:t.product_name,title:"Product"},on:{assignTo:function(t){e.product_id=t.id,e.product_name=t.name}}}),t._v("\n      Expected Date: "+t._s(t.expected_date?t.$luxon(t.expected_date):"Not Set")+"\n      "),n(f.a,{attrs:{outlined:"",label:"Initial Remarks"},model:{value:t.initial_inspection,callback:function(e){t.initial_inspection=e},expression:"initial_inspection"}}),t._v(" "),n(l.a,{attrs:{outlined:"",items:["New Installation","Old Installation","Replacement","Repair","Delivery"],label:"Service Type"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}}),t._v(" "),n(v.a,{attrs:{outlined:"",items:t.serviceForms,label:"Service Form","prepend-inner-icon":"mdi-form-select"},model:{value:t.service_type,callback:function(e){t.service_type=e},expression:"service_type"}}),t._v(" "),n(f.a,{attrs:{filled:"",readonly:"",disabled:"Subadmin"==t.role,items:t.statusItems,label:"Ticket Status"},model:{value:t.ticket_status,callback:function(e){t.ticket_status=e},expression:"ticket_status"}}),t._v(" "),n(v.a,{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{outlined:"",disabled:"Subadmin"==t.role,items:t.statusItems,label:"Work Status"},model:{value:t.work_status,callback:function(e){t.work_status=e},expression:"work_status"}}),t._v(" "),n("div",[n(o.a,{directives:[{name:"show",rawName:"v-show",value:"Validation"==t.ticket_status||t.time_location&&t.time_location.end,expression:"ticket_status=='Validation'||(time_location&&time_location.end)"}],attrs:{color:"indigo",dark:""},on:{click:function(e){return t.closeTicket()}}},[t._v("Close Ticket")]),t._v(" "),n(_.a,{attrs:{small:""}},[t._v("mdi-information-outline")]),t._v(" Marks Ticket as Closed\n        "),n("p"),t._v(" "),n(o.a,{attrs:{color:"indigo",dark:""},on:{click:function(e){t.rescheduler=!0}}},[t._v("Reschedule Ticket")])],1)],1),t._v(" "),n(c.a,[t.form_id?n(o.a,{attrs:{outlined:"",to:"/app/services/forms?id=".concat(t.$route.query.id),color:"primary"}},[t._v("View Form")]):t._e(),t._v(" "),t.$route.query.id?n(o.a,{attrs:{outlined:"",color:"primary"},on:{click:function(e){t.viewHistory=!0}}},[t._v("View Activity")]):t._e(),t._v(" "),n(h.a),t._v(" "),n(o.a,{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:t.loading,type:"submit"},on:{click:function(e){return t.updateService()}}},[t._v("Save Service")])],1),t._v(" "),t.$route.query.id&&t.viewHistory?n("history",{attrs:{service_id:t.$route.query.id},model:{value:t.viewHistory,callback:function(e){t.viewHistory=e},expression:"viewHistory"}}):t._e()],1),t._v(" "),n(d.a,{attrs:{"max-width":"400"},model:{value:t.rescheduler,callback:function(e){t.rescheduler=e},expression:"rescheduler"}},[n(r.a,[n(c.d,[t._v("Reschedule Service")]),t._v(" "),n(c.c,[t._v("\n      Expected Date: "+t._s(t.expected_date?t.$luxon(t.expected_date):"Not Set")+"\n      "),n(f.a,{attrs:{filled:"",type:"date",label:t.product_id?"Reschedule":"Set Date"},on:{change:function(e){return t.updateTicketStatus()}},model:{value:t.expected_date,callback:function(e){t.expected_date=e},expression:"expected_date"}})],1),t._v(" "),n(c.a,[n(o.a,{staticClass:"spl-btn",attrs:{color:"primary",large:"",loading:t.loading,type:"submit"},on:{click:function(e){return t.updateService()}}},[t._v("Save")]),t._v(" "),n(o.a,{attrs:{outlined:"",color:"primary"},on:{click:function(e){t.rescheduler=!1}}},[t._v("Cancel")])],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports},759:function(e,t,n){"use strict";var o=n(568),r={props:{id:{default:null},value:{default:{}}},data:function(){return{createDialog:!1,assignee:{},zone_search:"",zones:[],loadingZones:!1,show1:!1}},watch:{zone_search:function(){this.searchZones()}},methods:{searchZones:function(){var e,t=this;(null===(e=this.zone_search)||void 0===e?void 0:e.length)<=2||(this.loadingZones=!0,this.$axios.get("/auth/users/".concat(this.id,"/zones"),{params:{name:this.zone_search,is:this.permissions}}).then((function(e){e.data&&e.data.length&&(t.zones=e.data),t.loadingZones=!1}),(function(e){t.loadingZones=!1})))}}},c=n(26),component=Object(c.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("p",[e._v("Zone Search: "),t("b",[e._v(e._s(e.value.zone))]),e._v(" "+e._s(e.value.address)+" ")]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t(o.a,{attrs:{dense:"",outlined:"",clearable:"",loading:e.loadingZones,"search-input":e.zone_search,label:"Search Zone","item-text":"zone","return-object":"","prepend-inner-icon":"mdi-magnify",items:e.zones},on:{focus:function(t){return e.searchZones()},input:function(t){t?e.$emit("input",t):e.$emit("input",{})},"update:searchInput":function(t){e.zone_search=t},"update:search-input":function(t){e.zone_search=t}}})],1)])}),[],!1,null,null,null);t.a=component.exports},786:function(e,t,n){var content=n(895);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(9).default)("329d8de3",content,!0,{sourceMap:!1})},894:function(e,t,n){"use strict";n(786)},895:function(e,t,n){var o=n(8)((function(i){return i[1]}));o.push([e.i,".statusBar{border:1px solid var(--v-primary-base)}",""]),o.locals={},e.exports=o}}]);