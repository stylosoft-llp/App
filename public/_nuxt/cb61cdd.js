(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1051:function(t,e,r){"use strict";r.r(e);r(15),r(11),r(14),r(23),r(13),r(24);var o=r(3);r(6),r(33),r(34),r(32);function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var n={layout:"appDesktop",data:function(){return{loading:!1,service:{},serviceFormData:[],signatureToggle:!1}},components:{serviceForm:function(){return r.e(16).then(r.bind(null,1075))},signature:function(){return Promise.all([r.e(14),r.e(15),r.e(22)]).then(r.bind(null,1076))}},mounted:function(){this.$route.query.id&&this.fetchService()},methods:{changeValue:function(t){var e=this.serviceFormData;e[t[1]]=t[0],this.serviceFormData=e},fetchService:function(){var t=this;this.$axios.get("auth/services/"+this.$route.query.id).then((function(e){var r,o;t.service=e.data,t.serviceFormData=(null===(r=e.data)||void 0===r||null===(o=r.form)||void 0===o?void 0:o.data)||[]}))},updateService:function(){var t=this,e=this.$route.query.id||null,r=this.service;r.form=this.serviceFormData,this.$axios.put("auth/tasks/"+e,r).then((function(e){t.$toast.success("Service Saved",{icon:"mdi-check-circle"}),t.$route.query.id||t.$router.push("/app/services")}),(function(e){t.$toast.error("Something Went Wrong",{icon:"mdi-alert"})}))},addRecord:function(t){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var r=t.coords,n={accuracy:r.accuracy,latitude:r.latitude,longitude:r.longitude},time=(new Date).toISOString(),l=e.service.time_location||{};l.start&&l.start.time?(l.end={time:time,coordinates:n},e.$toast.show("Activity Finished")):(l.start={time:time,coordinates:n},e.$toast.show("Activity Started")),e.service.time_location=function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},l),e.updateService()}),(function(t){e.$toast.error(t.message)}))},geoCode:function(t,e){var r=this;this.longitude=t,this.latitude=e,this.$axios.get("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t,",").concat(e,".json?types=locality,place,region&access_token=pk.eyJ1Ijoib3duZWFyIiwiYSI6ImNqenljaGZwdjA1NzgzbnFoNXJucDN0cWkifQ.-tT0ZJBV0V0cVrncpFKimw")).then((function(t){var e=t.data.features;r.location=e[0].place_name,r.$emit("set-location",[r.coordinates,r.location]),r.manual=!1}),(function(t){r.$emit("unable")}))}}},l=n,v=r(27),d=r(31),m=r.n(d),_=r(494),h=r(211),f=r(177),y=r(579),k=r(506),w=r(210),S=r(515),x=r(546),$=r(504),O=r(554),component=Object(v.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-layout",{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[r("v-card",{attrs:{width:"100%"}},[r("v-card-text",[r("div",{staticClass:"d-flex flex-row my-2"},[r("v-btn",{attrs:{small:"",color:"primary",outlined:""},on:{click:function(e){return t.$router.back()}}},[r("v-icon",[t._v("mdi-arrow-left")])],1),r("v-spacer"),t._v(" "),r("h2",{staticClass:"black--text"},[t._v(t._s(t.service.name||"Task Activity"))])],1),t._v(" "),r("v-container",[t.service?r("div",{staticClass:"my-6"},[t.service.customer?r("p",{staticClass:"font-weight-bold mb-1"},[t._v("Customer: "+t._s(t.service.customer.name))]):t._e(),t._v(" "),t.service.zone?r("p",{staticClass:"font-weight-bold mb-1"},[t._v("Zone: "+t._s(t.service.zone.zone))]):t._e(),t._v(" "),t.service.zone?r("p",[t._v(t._s(t.service.zone.address))]):t._e(),t._v(" "),t.service.time_location&&t.service.time_location.start?t.service.time_location&&t.service.time_location.start&&!t.service.time_location.end?r("v-btn",{attrs:{color:"accent"},on:{click:function(e){return t.addRecord()}}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-check-bold")]),t._v(" Finish Activity")],1):t._e():r("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.addRecord()}}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-clock-fast")]),t._v(" Start Activity")],1),t._v(" "),r("v-textarea",{staticClass:"my-2",attrs:{outlined:"",label:"Activity Remarks",rows:"2"},model:{value:t.service.remarks,callback:function(e){t.$set(t.service,"remarks",e)},expression:"service.remarks"}}),t._v(" "),r("v-simple-table",[r("thead",[r("tr",[r("th",[t._v("Activity")]),t._v(" "),r("th",[t._v("Date/Time")]),t._v(" "),r("th",[t._v("Location")])])]),t._v(" "),t.service.time_location?r("tbody",[t.service.time_location.start?r("tr",[r("td",[t._v("Start")]),t._v(" "),r("td",[t._v(t._s(t.service.time_location.start.time&&t.$luxon(t.service.time_location.start.time,"meds")))]),t._v(" "),t.service.time_location.start.coordinates?r("td",[r("a",{attrs:{href:"https://maps.google.com/?q="+t.service.time_location.start.coordinates.latitude+","+t.service.time_location.start.coordinates.longitude}},[t._v(t._s("Latitude: "+t.service.time_location.start.coordinates.latitude)+" "),r("br"),t._v(" "+t._s("Longitude: "+t.service.time_location.start.coordinates.longitude))])]):t._e()]):t._e(),t._v(" "),t.service.time_location.end?r("tr",[r("td",[t._v("Finish")]),t._v(" "),r("td",[t._v(t._s(t.service.time_location.start.time&&t.$luxon(t.service.time_location.start.time,"meds")))]),t._v(" "),r("td",[t._v(t._s(t.service.time_location.end.coordinates&&"Latitude:"+t.service.time_location.end.coordinates.latitude)+" "),r("br"),t._v(" "+t._s("Longitude: "+t.service.time_location.end.coordinates.longitude))])]):t._e()]):t._e()])],1):t._e(),t._v(" "),r("v-card",{staticClass:"container",attrs:{outlined:""}},[r("v-chip",{staticStyle:{top:"-25px"},attrs:{color:"primary",label:""}},[t._v("Form")]),t._v(" "),r("serviceForm",{attrs:{formData:t.serviceFormData},on:{changeValue:function(e){return t.changeValue(e)}}})],1),t._v(" "),t.service.signature?r("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.$config.media_url+"/"+t.service.signature}}):t._e(),t._v(" "),r("br"),t._v(" "),r("v-btn",{attrs:{outlined:"",color:"primary"},on:{click:function(e){t.signatureToggle=!0}}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-signature-freehand")]),t._v("Add Signature")],1)],1)],1),t._v(" "),r("v-card-actions",[r("v-btn",{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:t.loading,type:"submit",block:""},on:{click:function(e){return t.updateService()}}},[t._v("\n        Save Service")])],1)],1),t._v(" "),t.signatureToggle?r("signature",{on:{saveSignature:function(e){t.service.signature=e,t.updateService()}},model:{value:t.signatureToggle,callback:function(e){t.signatureToggle=e},expression:"signatureToggle"}}):t._e()],1)}),[],!1,null,null,null);e.default=component.exports;m()(component,{VBtn:_.a,VCard:h.a,VCardActions:f.a,VCardText:f.c,VChip:y.a,VContainer:k.a,VIcon:w.a,VLayout:S.a,VSimpleTable:x.a,VSpacer:$.a,VTextarea:O.a})}}]);