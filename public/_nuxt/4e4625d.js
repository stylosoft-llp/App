(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{1078:function(e,t,r){"use strict";r.r(t);var o=r(816),n=r(509),c=r(220),l=r(124),v=r(593),d=r(523),m=r(219),_=r(529),f=r(560),h=r(519),y=r(573),k=(r(25),r(32),r(15),r(10),r(14),r(21),r(13),r(22),r(3));r(5),r(33),r(35),r(30),r(48);function w(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(t){Object(k.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O={layout:"userDesktop",data:function(){return{loading:!1,service:{},serviceFormData:[],signatureToggle:!1,geoUndefined:!1}},components:{serviceForm:function(){return r.e(16).then(r.bind(null,1091))},signature:function(){return Promise.all([r.e(14),r.e(15),r.e(22)]).then(r.bind(null,1092))}},mounted:function(){this.$route.query.id&&this.fetchService()},methods:{changeValue:function(e){var t=this.serviceFormData;t[e[1]]=e[0],this.serviceFormData=t},fetchService:function(){var e=this;this.$axios.get("auth/services/"+this.$route.query.id).then((function(t){var r,o;e.service=t.data,e.serviceFormData=(null===(r=t.data)||void 0===r||null===(o=r.form)||void 0===o?void 0:o.data)||[]}))},updateService:function(){var e=this,t=this.$route.query.id||null,r=this.service;r.form=this.serviceFormData,this.$axios.put("auth/tasks/"+t,r).then((function(t){e.$toast.success("Service Saved",{icon:"mdi-check-circle"}),e.$route.query.id||e.$router.replace({query:S(S({},e.$route.query),{},{id:t.data.id})})}),(function(e){}))},addRecord:function(e){var t=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var r=e.coords,o={accuracy:r.accuracy,latitude:r.latitude,longitude:r.longitude},time=(new Date).toISOString(),n=t.service.time_location||{};n.start&&n.start.time?(n.end={time:time,coordinates:o},t.service.ticket_status="Validation",t.$toast.show("Activity Finished")):(n.start={time:time,coordinates:o},t.$toast.show("Activity Started")),t.service.time_location=S({},n),t.updateService()}),(function(e){t.$toast.error(e.message)})):geoUndefined=!0},geoCode:function(e,t){this.longitude=e,this.latitude=t}}},x=r(26),component=Object(x.a)(O,(function(){var e,t,r=this,k=r._self._c;return k(_.a,{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[k(c.a,{attrs:{width:"100%"}},[k(l.c,[k("div",{staticClass:"d-flex flex-row my-2"},[k(n.a,{attrs:{small:"",color:"primary",outlined:""},on:{click:function(e){return r.$router.back()}}},[k(m.a,[r._v("mdi-arrow-left")])],1),k(h.a),r._v(" "),k("h2",{staticClass:"black--text"},[r._v(r._s(r.service.name||"Task Activity"))])],1),r._v(" "),k(d.a,[r.service?k("div",{staticClass:"my-6"},[r.service.customer?k("p",{staticClass:"font-weight-bold mb-1"},[r._v("Customer: "+r._s(r.service.customer.name)+" â€¢ "+r._s((null===(e=r.service.customer)||void 0===e||null===(t=e.user_detail)||void 0===t?void 0:t.company_name)||""))]):r._e(),r._v(" "),r.service.zone?k("p",{staticClass:"font-weight-bold mb-1"},[r._v("Zone: "+r._s(r.service.zone.zone))]):r._e(),r._v(" "),r.service.zone?k("p",[r._v(r._s(r.service.zone.address))]):r._e(),r._v(" "),r.service.time_location&&r.service.time_location.start?r._e():k(n.a,{attrs:{color:"primary"},on:{click:function(e){return r.addRecord()}}},[k(o.a,{model:{value:r.geoUndefined,callback:function(e){r.geoUndefined=e},expression:"geoUndefined"}},[r._v("Geolocation Unavailable")]),r._v(" "),k(m.a,{attrs:{left:""}},[r._v("mdi-clock-fast")]),r._v(" Start Activity")],1),r._v(" "),k(y.a,{staticClass:"my-2",attrs:{outlined:"",label:"Activity Remarks",rows:"2"},model:{value:r.service.remarks,callback:function(e){r.$set(r.service,"remarks",e)},expression:"service.remarks"}}),r._v(" "),k(f.a,[k("thead",[k("tr",[k("th",[r._v("Activity")]),r._v(" "),k("th",[r._v("Date/Time")])])]),r._v(" "),r.service.time_location?k("tbody",[r.service.time_location.start?k("tr",[k("td",[r._v("Start")]),r._v(" "),k("td",[r._v(r._s(r.service.time_location.start.time&&r.$luxon(r.service.time_location.start.time,"meds")))])]):r._e(),r._v(" "),r.service.time_location.end?k("tr",[k("td",[r._v("Finish")]),r._v(" "),k("td",[r._v(r._s(r.service.time_location.end.time&&r.$luxon(r.service.time_location.end.time,"meds")))])]):r._e()]):k("div",{staticClass:"amber--text text--darken-3 font-weight-bold"},[r._v("No Time/Location Added")])])],1):r._e(),r._v(" "),k(c.a,{staticClass:"container",attrs:{outlined:""}},[k(v.a,{staticStyle:{top:"-25px"},attrs:{color:"primary",label:""}},[r._v("Form")]),r._v(" "),k("serviceForm",{attrs:{formData:r.serviceFormData},on:{changeValue:function(e){return r.changeValue(e)}}})],1),r._v(" "),r.service.signature?k("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"".concat(r.$config.media_url,"/").concat(r.service.signature)}}):r._e(),r._v(" "),k("br"),r._v(" "),k(n.a,{attrs:{outlined:"",color:"primary"},on:{click:function(e){r.signatureToggle=!0}}},[k(m.a,{attrs:{left:""}},[r._v("mdi-signature-freehand")]),r._v("Add Signature")],1),r._v(" "),r.service.time_location&&r.service.time_location.start&&!r.service.time_location.end?k(n.a,{attrs:{color:"accent"},on:{click:function(e){return r.addRecord()}}},[k(m.a,{attrs:{left:""}},[r._v("mdi-check-bold")]),r._v(" Finish Activity")],1):r._e()],1)],1),r._v(" "),k(l.a,[k(n.a,{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:r.loading,type:"submit",block:""},on:{click:function(e){return r.updateService()}}},[r._v("\n          Save Service")])],1)],1),r._v(" "),r.signatureToggle?k("signature",{on:{saveSignature:function(e){r.service.signature=e,r.updateService()}},model:{value:r.signatureToggle,callback:function(e){r.signatureToggle=e},expression:"signatureToggle"}}):r._e()],1)}),[],!1,null,null,null);t.default=component.exports}}]);