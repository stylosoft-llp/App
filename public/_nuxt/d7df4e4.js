(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1066:function(t,e,o){"use strict";o.r(e);var r=o(509),n=o(220),c=o(124),l=o(593),v=o(523),d=o(219),_=o(529),m=o(560),h=o(519),f=o(573),y=(o(25),o(32),o(15),o(10),o(14),o(21),o(13),o(22),o(3));o(5),o(33),o(35);function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}var w={layout:"appDesktop",data:function(){return{loading:!1,service:{},serviceFormData:[],signatureToggle:!1,geoLocating:!1}},components:{serviceForm:function(){return o.e(16).then(o.bind(null,1091))},signature:function(){return Promise.all([o.e(14),o.e(15),o.e(22)]).then(o.bind(null,1092))}},mounted:function(){this.$route.query.id&&this.fetchService()},methods:{changeValue:function(t){var e=this.serviceFormData;e[t[1]]=t[0],this.serviceFormData=e},fetchService:function(){var t=this;this.$axios.get("auth/services/"+this.$route.query.id).then((function(e){var o,r;t.service=e.data,t.serviceFormData=(null===(o=e.data)||void 0===o||null===(r=o.form)||void 0===r?void 0:r.data)||[]}))},updateService:function(){var t=this;this.loading=!0;var e=this.$route.query.id||null,o=this.service;o.form=this.serviceFormData,this.$axios.put("auth/tasks/"+e,o).then((function(e){t.$toast.success("Service Saved",{icon:"mdi-check-circle"}),t.$route.query.id||t.$router.push("/app/services")}),(function(e){t.$toast.error("Something Went Wrong",{icon:"mdi-alert"})})).finally((function(){t.loading=!1}))},addRecord:function(t){var e=this;this.geoLocating=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){var o=t.coords;e.$toast.success("Time and Location Fetched");var r={accuracy:o.accuracy,latitude:o.latitude,longitude:o.longitude},time=(new Date).toISOString(),n=e.service.time_location||{};n.start&&n.start.time?(n.end={time:time,coordinates:r},e.$toast.show("Activity Finished"),e.service.ticket_status="Validation"):(n.start={time:time,coordinates:r},e.$toast.show("Activity Started")),e.service.time_location=function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(y.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},n),e.geoLocating=!1,e.updateService()}),(function(t){e.$toast.error(t.message),e.geoLocating=!1})):this.geoLocating=!1},geoCode:function(t,e){this.longitude=t,this.latitude=e}}},S=w,O=o(26),component=Object(O.a)(S,(function(){var t,e,o=this,y=o._self._c;return y(_.a,{attrs:{column:"","align-center":"","justify-center":"","fill-height":""}},[y(n.a,{attrs:{width:"100%"}},[y(c.c,[y("div",{staticClass:"d-flex flex-row my-2"},[y(r.a,{attrs:{small:"",color:"primary",outlined:""},on:{click:function(t){return o.$router.back()}}},[y(d.a,[o._v("mdi-arrow-left")])],1),y(h.a),o._v(" "),y("h2",{staticClass:"black--text"},[o._v(o._s(o.service.name||"Task Activity"))])],1),o._v(" "),y(v.a,[o.service?y("div",{staticClass:"my-6"},[o.service.customer?y("p",{staticClass:"font-weight-bold mb-1"},[o._v("Customer: "+o._s(o.service.customer.name)+" â€¢ "+o._s((null===(t=o.service.customer)||void 0===t||null===(e=t.user_detail)||void 0===e?void 0:e.company_name)||""))]):o._e(),o._v(" "),o.service.zone?y("p",{staticClass:"font-weight-bold mb-1"},[o._v("Zone: "+o._s(o.service.zone.zone))]):o._e(),o._v(" "),o.service.zone?y("p",[o._v(o._s(o.service.zone.address))]):o._e(),o._v(" "),o.service.time_location&&o.service.time_location.start?o._e():y(r.a,{attrs:{color:"primary",loading:o.geoLocating},on:{click:function(t){return o.addRecord()}}},[y(d.a,{attrs:{left:""}},[o._v("mdi-clock-fast")]),o._v(" Start Activity")],1),o._v(" "),y(f.a,{staticClass:"my-2",attrs:{outlined:"",label:"Activity Remarks",rows:"2"},model:{value:o.service.remarks,callback:function(t){o.$set(o.service,"remarks",t)},expression:"service.remarks"}}),o._v(" "),y(m.a,[y("thead",[y("tr",[y("th",[o._v("Activity")]),o._v(" "),y("th",[o._v("Date/Time")]),o._v(" "),y("th",[o._v("Location")])])]),o._v(" "),o.service.time_location?y("tbody",[o.service.time_location.start?y("tr",[y("td",[o._v("Start")]),o._v(" "),y("td",[o._v(o._s(o.service.time_location.start.time&&o.$luxon(o.service.time_location.start.time,"meds")))]),o._v(" "),o.service.time_location.start.coordinates?y("td",[y("a",{attrs:{target:"_blank",href:"https://maps.google.com/?q=".concat(o.service.time_location.start.coordinates.latitude,",").concat(o.service.time_location.start.coordinates.longitude)}},[o._v(o._s("Latitude: "+o.service.time_location.start.coordinates.latitude)+" "),y("br"),o._v(" "+o._s("Longitude: "+o.service.time_location.start.coordinates.longitude))])]):o._e()]):o._e(),o._v(" "),o.service.time_location.end?y("tr",[y("td",[o._v("Finish")]),o._v(" "),y("td",[o._v(o._s(o.service.time_location.end.time&&o.$luxon(o.service.time_location.end.time,"meds")))]),o._v(" "),y("td",[y("a",{attrs:{target:"_blank",href:"https://maps.google.com/?q=".concat(o.service.time_location.end.coordinates.latitude,",").concat(o.service.time_location.end.coordinates.longitude)}},[o._v(o._s(o.service.time_location.end.coordinates&&"Latitude:"+o.service.time_location.end.coordinates.latitude)+" "),y("br"),o._v(" "+o._s("Longitude: "+o.service.time_location.end.coordinates.longitude)+"\n              ")])])]):o._e()]):y("div",{staticClass:"amber--text text--darken-3 font-weight-bold"},[o._v("No Time/Location Added")])])],1):o._e(),o._v(" "),y(n.a,{staticClass:"container",attrs:{outlined:""}},[y(l.a,{staticStyle:{top:"-25px"},attrs:{color:"primary",label:""}},[o._v("Form")]),o._v(" "),y("serviceForm",{attrs:{formData:o.serviceFormData},on:{changeValue:function(t){return o.changeValue(t)}}})],1),o._v(" "),o.service.signature?y("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"".concat(o.$config.media_url,"/").concat(o.service.signature)}}):o._e(),o._v(" "),y("br"),o._v(" "),y(r.a,{attrs:{outlined:"",color:"primary"},on:{click:function(t){o.signatureToggle=!0}}},[y(d.a,{attrs:{left:""}},[o._v("mdi-signature-freehand")]),o._v("Add Signature")],1),o._v(" "),o.service.time_location&&o.service.time_location.start&&!o.service.time_location.end?y(r.a,{attrs:{loading:o.geoLocating,color:"accent"},on:{click:function(t){return o.addRecord()}}},[y(d.a,{attrs:{left:""}},[o._v("mdi-check-bold")]),o._v(" Finish Activity")],1):o._e()],1)],1),o._v(" "),y(c.a,[y(r.a,{staticClass:"spl-btn mx-auto",attrs:{color:"primary",large:"",loading:o.loading,type:"submit",block:""},on:{click:function(t){return o.updateService()}}},[o._v("\n        Save Service")])],1)],1),o._v(" "),o.signatureToggle?y("signature",{on:{saveSignature:function(t){o.service.signature=t,o.updateService()}},model:{value:o.signatureToggle,callback:function(t){o.signatureToggle=t},expression:"signatureToggle"}}):o._e()],1)}),[],!1,null,null,null);e.default=component.exports}}]);